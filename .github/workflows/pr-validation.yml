name: PR Validation

on:
  pull_request:
    branches:
      - 'add-place/**'
      - 'add-portal/**'
  workflow_dispatch:
    inputs:
      branch:
        description: 'The branch to validate'
        required: true
      pr_number:
        description: 'The PR number'
        required: true

jobs:
  validate_pr_files:
    runs-on: ubuntu-latest
    name: Validate Files in PR
    steps:
      - name: ğŸ“‚ Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.branch || github.head_ref }}
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      - name: ğŸ“¦ Install dependencies
        run: npm install ajv
      - name: ğŸ” Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v41
        with:
          files: |
            public/data/places/**/*.json
            public/data/portals/**/*.json
      - name: âœ… Validate Changed Files
        if: steps.changed-files.outputs.any_changed == 'true'
        run: |
          for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
            node .github/scripts/validate-data.js "$file"
          done
      - name: ğŸ–¼ï¸ Get changed images
        id: changed-images
        uses: tj-actions/changed-files@v41
        with:
          files: public/data/place_images/**/*.{png,jpg,jpeg,gif}
      - name: âœ… Validate Image Filenames
        if: steps.changed-images.outputs.any_changed == 'true'
        run: |
          node .github/scripts/validate-images.js ${{ steps.changed-images.outputs.all_changed_files }}
